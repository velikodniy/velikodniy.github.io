https://twitter.com/vlcdn/status/1328065156035833857

Я тут иногда собеседую людей на работе. Оказалось, мало кто знает про guided filter. Не то, чтобы это как-то было важно для приёма на работу, просто наблюдение.
А ведь это очень простая и полезная штука. Работает хорошо и намного быстрее билатерального фильтра.

Идея там такая. Пусть у нас есть два изображения: шумное входное (p, мы его будем уточнять) и опорное (I). Мы хотим получить выходное изображение q и делаем два предположения.
Во-первых, в выходном мы убираем шум (q=p-n).
Во-вторых, мы хотим, чтоб сохранялись границы и форма.

Как сохранять форму? Можно потребовать, чтоб градиент выходного изображения в некоторой окрестности r был пропорционален градиенту опорного изображения. А раз градиенты пропорциональны, то q=aI+b. Осталось найти эти коэффициенты a и b.

Чтоб найти их будем минимизировать sum (aI+b-p)² + ea². Второе слагаемое в сумме — это регуляризация, чтоб коэффициент a сильно большим не был. Полезно для управления эффектом. Суммируем в некоторой окрестности текущего пикселя. И для каждого пикселя у нас свои коэффициенты.

У этой задачи есть решение в явном виде, так что вычислить коэффициенты можно очень быстро. Для скорости окрестности можно брать квадратными (тогда можно использовать интегральное изображение для поиска средних). Некоторые расчёты можно выполнять на меньшем разрешении.

На сайте автора (а это Kaiming He, подаривший нам ResNet, например) есть статья, слайды и код (в RAR-архиве, хаха). http://kaiminghe.com/eccv10/
В принципе, эти два слайда всё объясняют.

https://pbs.twimg.com/media/Em48OrNXcAEFyIk?format=jpg&name=medium


Зачем всё это нужно? Ну, например, чтоб уточнять сегментационные маски, убирать шум, дымку и делать много других интересных вещей.

https://pbs.twimg.com/media/Em48O6vWMAAxQKg?format=jpg&name=900x900

