https://twitter.com/vlcdn/status/1348726383053299718

В этом треде будут случайные факты о Python. Я их специально не готовил заранее. Это просто то, что приходило в голову.

1. list в Python — это вовсе не связный список, а динамический массив. Название немного сбивает с толку новичков.

2. Проверка на включение in — это такая же операция как >, < или ==. Помните двойные неравенства вроде 1 < x < 5? Выражение 1 < x in [1, 2, 3] работает так же. Это (1 < x) and (x in [1, 2, 3]).

3. Да для Python есть компиляторы. И не только JIT как Numba (классная штука, кстати!), но и обычные. Например, Nuitka. Разговор о их целесообразности оставим за скобками.

4. Если на объект нет ссылок, то он уничтожается сразу, а не ждёт сборки мусора. GC нужен для сложных случаев, когда у нас есть циклические ссылки.

5. Python очень медленный, но м̶ы̶ ̶л̶ю̶б̶и̶м̶ ̶е̶г̶о̶ ̶н̶е̶ ̶з̶а̶ ̶э̶т̶о̶ обычно это не проблема. Python можно использовать для I/O bound задач или написать бинарный модуль на быстром языке программирования. (https://brmmm3.github.io/posts/2019/07/28/python_and_lua/)

6. Язык для файлов конфигурации Starlark (он же Skylark) от Google — это Python на минималках.

7. Многие знают, что числа от -5 до 255 интернированы. То есть заранее размещены в памяти.
В эту память при желании можно залезть и поменять значение так, чтоб литерал 5 имел значение 7. Весёлой отладки!

8. У интерпретатора Python есть ключи командной строки для оптимизации, но они просто удаляют assert и строки документации.

9. __ читается как dunder.

10. Формат pickle — это последовательность команд для специальной виртуальной машины. Опкод R может вызвать произвольную функцию. Например, os.system. Так что лучше не используйте pickle из ненадёжных источников.
И не храните в нём ничего на диске, он не для этого.

11. В последних версиях в dict ключи упорядочены. Но это не было сделано специально. Это был побочный эффект новой реализации словарей. Однако, разработчикам понравилось, и начиная с Python 3.7 это поведение гарантируется. Так что OrderedDict не нужен.

12. Если вы скучаете по структурам, посмотрите в сторону namedtuple или датаклассов. Они удобны!

13. Python — это просто хобби-проект ван Россума на рождественские каникулы 1989 года.

14. У циклов есть блок else, который часто очень удобен.

15. У функции может быть вызвано два return. Например:
def f():
    try:
        return 1
    finally:
        return 2
Функция вернёт 2.

16. Да, в Python есть многопоточность. Да, там честные потоки операционной системы. Да, они могут работать одновременно во многих случаях. Да, я знаю про GIL.

17. bool — это подкласс int. Гарантируется, что у False и True числовые значения 0 и 1.

18. Хэш-таблица любого словаря содержит примерно ⅓ пустых ячеек, чтоб эффективно работать. Ничего полезного в них не хранится.  Но это ячейки для ссылок, так что память расходуется не так сильно.

20. Модули — это синглтоны, создающиеся в момент первого импорта. Часто это полезно.

21. yield в генераторах может возвращать значения, которые отправлены в него снаружи методом send (да, есть такой).

22. Благодаря send и генераторам реализовали асинхронное программирование. async и await — это просто синтаксический сахар.

23. Список может содержать сам себя. Python это обнаруживает и не зацикливается при выводе.
>>> a = []
>>> a.append(a)
>>> a
[[...]]

24. В Python нет оптимизации хвостовой рекурсии не потому, что Гвидо не осилил, а потому, что он не хочет всё усложнять.
Если очень хочется, можно реализовать Y-комбинатор с оптимизацией и использовать его.
Если вам действительно нужна TCO, то вы знаете, как это сделать.

25. Для длинной арифметики Python хранит массив цифр в системе счисления с основанием 2³⁰.
Кстати, может быть и 2¹⁵. Если кому интересны подробности, читайте тут — https://github.com/python/cpython/blob/master/Include/longintrepr.h


26. В Python одновременно есть свёртка констант (когда константные выражения предвычисляются, чтоб не тратить время при исполнении) и длинная арифметика. Что может пойти не так?
Например, можно записать выражение из 16 символов (https://codegolf.stackexchange.com/questions/69189/build-a-compiler-bomb/69415#69415), которое разворачивается в более, чем 32 терабайта (!) байт-кода.
По ссылке есть и другие, не менее удивительные примеры компиляторных бомб.

27. NotImplemented — константа, NotImplementedError — исключение.

https://sadh.life/post/builtins/